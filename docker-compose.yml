services:
  # Nginx Proxy Manager with automatic HTTPS/SSL
  nginx-proxy-manager:
    image: 'jc21/nginx-proxy-manager:latest'
    container_name: nginx-proxy-manager
    restart: unless-stopped
    environment:
      TZ: "America/Santiago"
    ports:
      - "80:80"      # HTTP
      - "81:81"      # Admin Web UI
      - "443:443"    # HTTPS
    volumes:
      - ./nginx-proxy-manager/data:/data
      - ./nginx-proxy-manager/letsencrypt:/etc/letsencrypt
    networks:
      - app-network
    depends_on:
      - frontend
      - users-service
      - pets-service
      - adoptions-service
      - donations-service

  # Frontend React
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: frontend
    ports:
      - "3000:3000"  # Cambio temporal a 3001 para evitar cach√© del navegador
    env_file:
      - ./frontend/.env
    networks:
      - app-network
    restart: unless-stopped

  # Backend Services (Spring Boot + H2 embedded)
  users-service:
    build:
      context: ./backend/users-service
      dockerfile: Dockerfile
    container_name: users-service
    ports:
      - "8081:8081"  # Expuesto para desarrollo localhost
    volumes:
      - ./backend/users-service/data:/app/data
    networks:
      - app-network
    restart: unless-stopped

  pets-service:
    build:
      context: ./backend/pets-service
      dockerfile: Dockerfile
    container_name: pets-service
    ports:
      - "8082:8082"  # Expuesto para desarrollo localhost
    volumes:
      - ./backend/pets-service/data:/app/data
      - ./backend/pets-service/uploads:/app/uploads
    networks:
      - app-network
    restart: unless-stopped

  adoptions-service:
    build:
      context: ./backend/adoptions-service
      dockerfile: Dockerfile
    container_name: adoptions-service
    ports:
      - "8083:8083"  # Expuesto para desarrollo localhost
    volumes:
      - ./backend/adoptions-service/data:/app/data
    environment:
      - PETS_API_BASE=http://pets-service:8082
    networks:
      - app-network
    restart: unless-stopped

  donations-service:
    build:
      context: ./backend/donations-service
      dockerfile: Dockerfile
    container_name: donations-service
    ports:
      - "8084:8084"  # Expuesto para desarrollo localhost
    volumes:
      - ./backend/donations-service/data:/app/data
    networks:
      - app-network
    restart: unless-stopped

networks:
  app-network:
    driver: bridge
